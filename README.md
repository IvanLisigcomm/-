# 永续合约滚仓收益计算器

一个纯前端静态网页，模拟“滚仓复利”策略：价格每上涨到设定阈值（如 10%）时，将当前全部浮盈用于开新仓，形成复利滚动。

## 使用

直接用浏览器打开 `index.html`。

## 输入参数

- 初始本金 E0（USDT）
- 杠杆 L（×）
- 入场价格 P0（USDT）
- 每步加仓阈值 s（%）
- 步数 K（加仓次数）
- 单边 Taker 手续费率 t（按名义价值计）
- 每步资金费率 f（按名义价值计，可设 0 忽略）
- 结束时是否平仓（计入一次终平手续费）

## 模型与计算

- 价格路径：`P_k = P_0 * (1 + s)^k`
- 第 k 步（k 从 1 起）
  - 开仓名义：`N_k = L * E_{k-1}`
  - 持仓数量：`Q_k = N_k / P_{k-1}`
  - 本步盈亏：`PNL_k = Q_k * (P_k - P_{k-1})`
  - 手续费与资金费：
    - 平仓费：`fee^close_k = t * (P_k * Q_k)`
    - 资金费：`funding_k = f * N_k`
    - 扣除后权益：`E_k' = E_{k-1} + PNL_k - fee^close_k - funding_k`
    - 以全部权益重开：`fee^open_{k+1} = t * (L * E_k')`
    - 期末权益：`E_k = E_k' - fee^open_{k+1}`
- 若为最后一步并勾选“结束时平仓”，再扣一次终平手续费，近似为 `t * (L * E_K)`。

> 该模型为理想化近似，忽略滑点、标记价格差异、资金费方向变化、维持保证金分层、强平缓冲等交易所实现细节。仅用于学习研究与策略粗估。

## 开发

- 主要脚本：`app.js`
- 样式：`styles.css`
- 依赖：Chart.js（通过 CDN 引入）

## 许可

MIT
